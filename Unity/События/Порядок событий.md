#unity

- ## Cобытия в Unity3D делятся на три большие группы:

1. События, вызываемые по событиям (загрузка сцены, выход пользователя)  
    _Данная группа событий выполняется на нерегулярной основе_
2. События, вызываемые при прорисовке кадра  
    _В этом случае все используемые скрипты вызываются в цикле прорисовки экрана, а значит, будут непосредственно влиять на FPS (частоту кадров в секунду). Поэтому здесь нужно очень аккуратно работать с функциями, которые требуют много времени на обработку._
3. События, вызываемые при расчёте физики  
    _И последняя группа. Для расчёта физики создаётся отдельная, независимая нить, события в которой вызываются с определённым интервалом времени. Размер этого интервала можно настроить в пункте меню: Edit -> Project Settings -> Time -> Fixed Timestep._

Зная эту разбивку Вы уже можете принимать решения о том, где какой код лучше расположить.  
Однако, все вычисления, производимые как при расчёте физики, так и при прорисовке, влияют на «отзывчивость» игры. Поэтому, при разработке приложения, наиболее ресурсоёмкие вычисления желательно оформлять в сопрограммах **(Coroutine).** [[Корутина]]

## Функции событий

#### Первая загрузка сцены

Эти функции вызываются, когда сцена стартует (по одному разу для каждого объекта в кадре).

- **Awake**: Эта функция всегда вызывается до начала любых функций, а также сразу после инициализации префаба.
- **OnEnable**: (вызывается, если объект является активным): Эта функция вызывается только после того, как объект будет включен.
#### До первого обновления кадров

- **Start**: вызывается перед прорисовкой первого фрейма, только если сценарий определён.
#### В промежутке между кадрами

- **OnApplicationPause**: Это событие вызывается в конце кадра, когда обнаружена пауза, фактически между обычными обновлениями кадров. После **OnApplicationPause** прорисовывается один дополнительный кадр для того, чтобы показать окно, которое отображается во время паузы.
#### Порядок обновления

Для отслеживания логики игры, взаимодействия и анимации объектов, положения камеры и т.д., есть несколько различных событий, которые Вы можете использовать. Общий механизм для выполнения большинства задач находится в функции **Update()**, но есть и другие функции.

- **FixedUpdate**: FixedUpdate() не зависит от Update(), и может вызываться как чаще него так и реже (обычно вызывается реже, если FPS достаточно высок). Это событие может быть вызвано несколько раз в кадре, если FPS низкий а может быть и вообще не вызвано между кадрами, если FPS высокий. Все физические расчеты движка и обновление происходит сразу после FixedUpdate(). При применении расчетов движения внутри FixedUpdate(), вам не нужно умножать ваше значение на Time.deltaTime. Это потому, что FixedUpdate() вызывается из таймера, независимого от частоты кадров.
- **Update**: Update() вызывается один раз за кадр. **Это основное событие для прорисовки кадра.**
- **LateUpdate**: LateUpdate() вызывается один раз в кадре, после завершения Update(). Любые расчеты, которые осуществляются в Update() будет завершены, при вызове LateUpdate(). Основным использованием LateUpdate() обычно является слежение за камерой от третьего лица. 
- ###### Если Вы осуществите движение Вашего персонажа в событии Update(), то движения камеры и расчётов её месторасположения можете вести в событии LateUpdate(). Это будет гарантировать, что персонаж прошел полностью перед камерой, и закрепил свое расположение.
#### Отрисовка сцены (Rendering)

- **OnPreCull**: Вызывается перед сборкой сцены на камере. Сборка определяет, какие объекты видны камере. OnPreCull вызывается, только если будет происходить «обрезка» сцены от невидимых объектов.
- **OnBecameVisible** / **OnBecameInvisible**: Вызывается, когда объект становится видимым / невидимым для любой камеры.
- **OnWillRenderObject**: Вызывается один раз для каждой камеры, если объект является видимым.
- **OnPreRender**: Вызывается перед тем, как на камеру начинается отрисовка сцены
- **OnRenderObject**: Вызывается, когда все объекты сцены прорисованы. Вы можете использовать функции GL или Graphics.DrawMeshNow, что-бы создать свои рисунки на этой камере.
- **OnPostRender**: Вызывается после завершения отрисовки сцены на камере.
- **OnRenderImage** (только Pro версия): Вызывается после прорисовки сцены, для постобработки изображения на экране.
- **OnGUI**: вызывается несколько раз в кадре в ответ на события интерфейса. События расположения и заполнения цветом обрабатываются в первую очередь, а затем события ввода с клавиатуры / мыши.
- **OnDrawGizmos**: Используется для рисования Gizmo на сцене.
#### Сопрограммы

Обычно вызов сопрограммы выполняется после возвращения функции Update(). Сопрограмма это функция, которая может приостановить исполнение (yield), пока не будет выполнена. Различные виды использования Сопрограмм:

- **yield**: сопрограмма будет продолжена после всех функций Update(), которые будут вызваны в следующем кадре.
- **yield WaitForSeconds(2)**: Продолжить после указанного времени задержки, когда все функции Update() уже были вызваны в кадре
- **yield WaitForFixedUpdate()**: Продолжается, когда все функции FixedUpdate() уже были вызваны
- **yield WWW**: Продолжается, когда загрузка WWW-контента завершена.
- **yield StartCoroutine(MyFunc)**: Связи сопрограмм, вызов сопрограммы будет ожидать завершения функции MyFunc.
#### Разрушение объектов

- **OnDestroy**: Эта функция вызывается для последнего кадра существования объекта (объект может быть уничтожен в ответ на Object.Destroy или при закрытии сцены).
#### При выходе

Эти функции вызываются для всех активных объектов в сцене:

- **OnApplicationQuit**: Эта функция вызывается для всех игровых объектов перед закрытием приложения. В редакторе это происходит, когда пользователь прекращает PlayMode. В веб-плеер это происходит при закрытии веб-плеера.
- **OnDisable**: Эта функция вызывается, когда объект отключается или становится неактивным.

  
- ### Таким образом, происходит такой порядок выполнения скриптов:  

- Все события **Awake**
- Все события **Start**
- **цикл (с шагом в переменной delta time)**
    - Все функции **FixedUpdate**
    - отработка **физического** движка
    - события триггеров **OnEnter/Exit/Stay**
    - события столкновений **OnEnter/Exit/Stay**
- **Rigidbody** преобразования, согласно transform.position и вращения
- **OnMouseDown/OnMouseUp** др. события ввода
- Все события **Update()**
- **Анимация**, смешение и трансформация
- Все события **LateUpdate**
- Прорисовка (**Rendering**)

![[Pasted image 20240125121142.png]]