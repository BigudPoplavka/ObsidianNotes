#Машинное_обучение #Нейросети 

[[Математическая функция]]
[[Обратное распространение ошибки]]

**Свертка** — это математическая операция, применяемая к двум функциям для получения третьей функции, которая выражает, насколько одна функция перекрывается с другой. В контексте изображений и нейронных сетей свертка используется для обработки данных с сетчатой структурой, таких как изображения, видео или аудиозаписи.
## Применение свертки в нейронных сетях

В сверточных нейронных сетях операция свертки выполняется с использованием специальных фильтров (ядер свертки), которые сканируют входные данные (например, изображение) и создают выходные данные (карты признаков).

![[Pasted image 20240725134058.png]]
## Подробное объяснение работы свертки над сетками изображений

### 1. Входные данные

Входными данными для свертки могут быть **различные массивы чисел, представляющие пиксели изображений**. Например, черно-белое изображение представлено двумерной сеткой чисел, где каждое число соответствует уровню серого (обычно от 0 до 255). Цветное изображение представляется трехмерной сеткой, где измерение отвечает за каналы цвета (RGB).
### 2. Фильтр (ядро свертки)

**Фильтр (ядро свертки или набор ядер)** — это небольшой **двумерный массив чисел** (например, 3x3 или 5x5), который используется для выделения определенных признаков на изображении, таких как края, текстуры и углы. ==**Значения фильтра (веса) инициализируются случайным образом и оптимизируются в процессе обучения сети.**==
### 3. Процесс свертки

Процесс свертки включает в себя перемещение фильтра по всему изображению и вычисление свертки фильтра с соответствующими участками изображения. Это производится путем **элемент-wise умножения значений фильтра и пикселей изображения с последующим суммированием результатов.**

Например, если у нас есть фильтр 3x3 и участок изображения 3x3:

| Изображение | Фильтр |
| ----------- | ------ |
| 1 2 3       | 1 0 -1 |
| 4 5 6       | 1 0 -1 |
| 7 8 9       | 1 0 -1 |

Результат:
`(1*1 + 2*0 + 3*(-1)) + (4*1 + 5*0 + 6*(-1)) + (7*1 + 8*0 + 9*(-1)) = 1 - 3 + 4 - 6 + 7 - 9 = -6`

Это значение записывается в соответствующую ячейку карты признаков.
### 4. Карты признаков (Feature Maps)

**Карта признаков** — это результат применения фильтра к изображению (также n-мерный массив). Она отражает наличие определенных признаков, таких как края или текстуры, в различных частях изображения. В результате свертки фильтр перемещается по всему изображению (с шагом или без него), создавая **двумерную карту признаков, которая затем передается на следующий слой.**
### 5. Паддинг и шаг

- **Паддинг**: Добавление дополнительных строк и столбцов вокруг изображения для сохранения размеров после применения свертки. Это помогает обрабатывать края изображения.
- **Шаг (Stride)**: Количество пикселей, на которое фильтр смещается по изображению после каждой операции свертки. Стандартный шаг равен 1, но может быть увеличен для уменьшения размера карты признаков.
### Откуда берутся входные числовые данные для свертки?

**Входные числовые данные обычно представляют собой пиксельные значения изображений.** В случае цветных изображений они разделены на три канала (RGB), каждый из которых является отдельной сеткой чисел. Эти данные могут быть загружены из файлов изображений (например, JPEG, PNG) и преобразованы в числовые массивы для дальнейшей обработки.
### Как мы задаём параметры свёртки (kernel size, stride, padding)

Свёртка (Conv2D) — это ключевая операция в свёрточных нейросетях для извлечения пространственных признаков из изображений. Параметры свёртки определяют, каким образом происходит эта операция.

1. **Размер ядра свёртки (kernel size)**
    
    Размер ядра определяет область (окно), по которой свёртка "проходит" на каждом шаге.
    
    - Типичные размеры: 3x3, 5x5, реже 7x7.
    - **Маленькие ядра (3x3)**: позволяют лучше выделять локальные признаки и более гибки.
    - **Большие ядра (5x5, 7x7)**: захватывают больше информации сразу, но могут пропускать мелкие детали.
    
    Пример: ядро 3x3 скользит по изображению и "видит" только область 3x3 на каждом шаге.
    
    В задачах классификации часто используется 3x3, так как оно эффективно обрабатывает локальные структуры изображения.
    
2. **Шаг (stride)**
    
    Шаг определяет, на сколько пикселей перемещается окно свёртки по изображению.
    
    - **Stride = 1**: свёртка перемещается на один пиксель, сохраняя много информации, но увеличивая вычислительную нагрузку.
    - **Stride = 2**: свёртка перемещается на два пикселя, уменьшая выходной размер, но теряя часть информации.
    
    Использование большего шага помогает уменьшить размер изображения быстрее, что может быть полезно для ускорения вычислений.
    
    Пример: если stride = 2, то после применения свёртки к изображению 32x32, размер выходного тензора уменьшится до 16x16.
    
3. **Пэддинг (padding)**
    
    Пэддинг — добавление дополнительных нулевых пикселей вокруг границ изображения перед свёрткой.
    
    - **Padding = 0 (valid)**: свёртка не добавляет нулевые пиксели, и размер изображения уменьшается.
    - **Padding = 1 (same)**: добавление нулевых пикселей для сохранения размера изображения при свёртке.
    
    Пример: при kernel size = 3x3 и padding = 1, размер изображения до и после свёртки останется таким же.
    
    Пэддинг нужен для того, чтобы:
    
    - Сохранить пространственную информацию у границ изображений (без пэддинга информация у краев будет "теряться").
    - Сохранить размер изображения, если это важно для последующих слоев.
### Обобщение процесса свертки в нейронных сетях

1. **Инициализация фильтров**: Фильтры инициализируются случайными весами.
2. **Применение свертки**: Фильтры перемещаются по изображению, выполняя операции свертки и создавая карты признаков.
3. **Обучение**: Во время обучения веса фильтров оптимизируются с помощью градиентного спуска и обратного распространения ошибки.
4. **Слои**: Сверточные слои могут быть последовательными, каждый из которых выделяет все более сложные признаки.
5. **Полносвязные слои**: В конце сети полносвязные слои используют карты признаков для выполнения классификации или другой задачи.

Операция свертки является фундаментальным компонентом в CNN, позволяя эффективно выделять признаки в изображениях и других данных с сетчатой структурой. Она включает в себя применение фильтров к входным данным и создание карт признаков, которые используются для решения различных задач, таких как классификация, обнаружение объектов и сегментация изображений.