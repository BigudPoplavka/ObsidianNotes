#Параллелизм #Паттерн_синхронизации 

**lock** - оператор, определяющий блок кода, который нужно заблокировать для других потоков, пока он не выполнится в текущем потоке.

Нередко в потоках используются некоторые разделяемые ресурсы, общие для всей программы. Это могут быть общие переменные, файлы, другие ресурсы.

- ## Например

`int` `x = 0;`

`for` `(``int` `i = 1; i < 6; i++)`
`{`
    `Thread myThread =` `new``(Print);`
    `myThread.Name = $``"Поток {i}"``;`  
    `myThread.Start();`
`}`

`void` `Print()`
`{`
    `x = 1;`
    `for` `(``int` `i = 1; i < 6; i++)`
    `{`
        `Console.WriteLine($``"{Thread.CurrentThread.Name}: {x}"``);`
        `x++;`
        `Thread.Sleep(100);`
    `}`
`}`

При запуске этого кода потоки будут хаотично инкрементировать `x`, так как доступ к переменной будет осуществляться конкурирующими потоками. 

Решение проблемы состоит в том, чтобы синхронизировать потоки и ограничить доступ к разделяемым ресурсам на время их использования каким-нибудь потоком. Для этого используется ключевое слово lock. Оператор lock определяет блок кода, внутри которого весь код блокируется и становится недоступным для других потоков до завершения работы текущего потока. Остальный потоки помещаются в очередь ожидания и ждут, пока текущий поток не освободит данный блок кода. В итоге с помощью lock мы можем переделать метод `Print` следующим образом:

`void` `Print()`
`{`
	`lock` `(locker)`
	    `{`
	        `x = 1;`
	        `for` `(``int` `i = 1; i < 6; i++)`
	        `{`
	            `Console.WriteLine($``"{Thread.CurrentThread.Name}: {x}"``);`
	            `x++;`
	            `Thread.Sleep(100);`
	        `}`
	    `}`
``}





